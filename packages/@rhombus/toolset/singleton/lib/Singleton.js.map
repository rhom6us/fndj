{"version":3,"file":"Singleton.js","sourceRoot":"","sources":["../src/Singleton.ts"],"names":[],"mappings":"AAAA,uCAAuC;AACvC,sCAAsC;AAKtC,MAAM,UAAU,SAAS,CAAiB,IAAO;IAC7C,OAAO,MAAM,SAAU,SAAQ,IAAI;QAC/B,MAAM,CAAC,SAAS,CAAsB;QACtC,YAAY,GAAG,IAAW;YACtB,MAAM,KAAK,GAAG,SAAS,CAAC,SAAS,EAAE,KAAK,EAAE,CAAC;YAC3C,IAAI,KAAK,EAAE;gBACP,OAAO,KAAK,CAAC;aAChB;YACD,KAAK,CAAC,GAAG,IAAI,CAAC,CAAC;YACf,SAAS,CAAC,SAAS,GAAG,IAAI,OAAO,CAAC,IAAI,CAAC,CAAC;QAC5C,CAAC;KACJ,CAAC;AACN,CAAC","sourcesContent":["/// <reference lib=\"es2015.iterable\" />\n/// <reference lib=\"es2021.weakref\" />\n\nimport { Ctor } from '@rhombus/func';\n\n\nexport function Singleton<T extends Ctor>(ctor: T): T {\n    return class Singleton extends ctor {\n        static #instance?: WeakRef<Singleton>;\n        constructor(...args: any[]) {\n            const value = Singleton.#instance?.deref();\n            if (value) {\n                return value;\n            }\n            super(...args);\n            Singleton.#instance = new WeakRef(this);\n        }\n    };\n}\n"]}